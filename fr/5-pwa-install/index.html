<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5. Installation d&#39;une PWA sur le système | PWA Workshop</title>
    <meta name="description" content="Introduction aux Progressive Web Applications">
    <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PWA Workshop Docs">
  <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">
    
    <link rel="preload" href="/assets/css/0.styles.aa2ecf69.css" as="style"><link rel="preload" href="/assets/js/app.ef97a632.js" as="script"><link rel="preload" href="/assets/js/3.c69d9a44.js" as="script"><link rel="preload" href="/assets/js/6.4e5f5461.js" as="script"><link rel="prefetch" href="/assets/js/1.70248c23.js"><link rel="prefetch" href="/assets/js/10.4dea1f5d.js"><link rel="prefetch" href="/assets/js/11.5c386266.js"><link rel="prefetch" href="/assets/js/12.3eef7c77.js"><link rel="prefetch" href="/assets/js/13.17b8c0c1.js"><link rel="prefetch" href="/assets/js/14.1323dc9b.js"><link rel="prefetch" href="/assets/js/15.c4c539ea.js"><link rel="prefetch" href="/assets/js/16.4207a3bc.js"><link rel="prefetch" href="/assets/js/17.624aed4e.js"><link rel="prefetch" href="/assets/js/18.1b81679e.js"><link rel="prefetch" href="/assets/js/19.f2ff2149.js"><link rel="prefetch" href="/assets/js/20.9ce1edaa.js"><link rel="prefetch" href="/assets/js/21.7c9ad059.js"><link rel="prefetch" href="/assets/js/22.a481eb05.js"><link rel="prefetch" href="/assets/js/23.7e285c59.js"><link rel="prefetch" href="/assets/js/24.e5dfe154.js"><link rel="prefetch" href="/assets/js/4.9fe3ad56.js"><link rel="prefetch" href="/assets/js/5.c8941447.js"><link rel="prefetch" href="/assets/js/7.c62337bd.js"><link rel="prefetch" href="/assets/js/8.e804527d.js"><link rel="prefetch" href="/assets/js/9.18f9247f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aa2ecf69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fr/" class="home-link router-link-active"><!----> <span class="site-name">PWA Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/5-pwa-install/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/fr/5-pwa-install/" class="nav-link router-link-exact-active router-link-active">Français</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Langue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/5-pwa-install/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/fr/5-pwa-install/" class="nav-link router-link-exact-active router-link-active">Français</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fr/" class="sidebar-link">Introduction</a></li><li><a href="/fr/1-manifest/" class="sidebar-link">1. Ajout d'un Web App Manifest</a></li><li><a href="/fr/2-service-worker/" class="sidebar-link">2. Installation d'un Service Worker</a></li><li><a href="/fr/3-precaching/" class="sidebar-link">3. Precaching et mode offline basique</a></li><li><a href="/fr/4-api-cache/" class="sidebar-link">4. Stratégie de Cache pour API REST</a></li><li><a href="/fr/5-pwa-install/" class="active sidebar-link">5. Installation d'une PWA sur le système</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fr/5-pwa-install/#criteres-pour-etre-installable" class="sidebar-link">Critères pour être installable</a></li><li class="sidebar-sub-header"><a href="/fr/5-pwa-install/#installation-de-la-pwa" class="sidebar-link">Installation de la PWA</a></li><li class="sidebar-sub-header"><a href="/fr/5-pwa-install/#ajout-d-un-invite-d-installation" class="sidebar-link">Ajout d'un invité d'installation</a></li></ul></li><li><a href="/fr/6-background-sync/" class="sidebar-link">6. Background sync et notifications</a></li><li><a href="/fr/finish.html" class="sidebar-link">Pour aller plus loin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="etape-5-installation-de-la-pwa-sur-le-systeme"><a href="#etape-5-installation-de-la-pwa-sur-le-systeme" class="header-anchor">#</a> Etape 5 : Installation de la PWA sur le système</h1> <h2 id="criteres-pour-etre-installable"><a href="#criteres-pour-etre-installable" class="header-anchor">#</a> Critères pour être installable</h2> <p>Un des avantages des PWA est qu’ils peuvent être installés s’ils respectent certains critères. Ce derniers dépendent du navigateur utilisé. Voici, à titre d'exemple, les critères de <a href="https://developers.google.com/web/fundamentals/app-install-banners/#criteria" target="_blank" rel="noopener noreferrer">Chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <ul><li>L'application Web n'est pas déjà installée.
<ul><li>et <code>prefer_related_applications</code> vaut <code>false</code>.</li></ul></li> <li>Rencontre une heuristique d'engagement de l'utilisateur (actuellement, l'utilisateur a interagi avec le domaine pendant au moins 30 secondes)</li> <li>Comprend un manifeste d'applications Web comprenant:
<ul><li><code>short_name</code> ou <code>name</code></li> <li>les icônes doivent inclure des icônes de 192px et 512px</li> <li><code>start_url</code></li> <li>l'affichage doit être l'un des suivants: <code>fullscreen</code>, <code>standalone</code> ou <code>minimal-ui</code></li></ul></li> <li>Servi sur HTTPS (obligatoire pour les agents de service)</li> <li>A inscrit un technicien de service avec un gestionnaire d'événements fetch</li></ul> <h2 id="installation-de-la-pwa"><a href="#installation-de-la-pwa" class="header-anchor">#</a> Installation de la PWA</h2> <p>Selon le navigateur et l'OS, les conditions techniques requises pour pouvoir installer la PWA sur le système varient. Mais en principe, si vous avez un manifeste et un Service Worker actif gérant les requêtes entrantes avec <code>fetch</code>, alors vous devriez pouvoir actuellement installer cette PWA sur toutes les plates-formes supportées, et elles mettront à profit le manifeste et le Service Worker.</p> <p>La plate-forme ayant la meilleure intégration ce jour est <strong>Android</strong>. Si vous disposez d'un smartphone Android pouvant requêter votre serveur suite à un partage de connexion, essayez de charger l'application via Chrome for Android. Une fois la page web ouverte, le menu de Chrome devrait comporter l'option: <strong>Add to home screen</strong></p> <p><img src="/assets/img/pwa_install_menu.41073796.jpg" alt="Add to home screen"></p> <p>Poursuivre l'installation. Un nouveau raccourci devrait apparaitre dans l'écran d'accueil du smartphone. C'est le raccourci vers notre PWA !</p> <p><img src="/assets/img/pwa_install.cc0b35b6.jpg" alt="PWA bookmark"> <img src="/assets/img/splash-screen.a247c4ec.jpg" alt="Splash-screen"></p> <p>Une fois la PWA installée, quand on clique sur le raccourci, un splash screen est affiché brièvement. Celui-ci reprend les couleurs et l'icône spécifiée dans le manifeste.</p> <p>Vous remarquerez que la barre d'adresse et le reste de l'interface du navigateur ne sont plus présentes, si vous avez configuré la propriété <code>display</code> en <code>standalone</code> dans le manifeste.</p> <p><img src="/assets/img/pwa-fullscreen.20336af1.jpg" alt="PWA run from bookmark"></p> <h2 id="ajout-d-un-invite-d-installation"><a href="#ajout-d-un-invite-d-installation" class="header-anchor">#</a> Ajout d'un invité d'installation</h2> <p>À l'origine, le navigateur gérait toutes les étapes liées à l'installation, de la présentation de la bannière à l'ajout de l'icône de l'application à l'écran d'accueil. Cependant, il est maintenant possible de gérer en partie la présentation de l'interface utilisateur menant à l'invité d'installation de la PWA. Dans ce cas, l'application doit vérifier si elle peut demander à être installée en écoutant l'événement <code>beforeinstallprompt</code>, puis demander au navigateur d'afficher l'invité d'installation si l'utilisateur le demande.</p> <p>Ajoutons notre propre <strong>bouton d'installation</strong> à notre PWA en procédant comme suit:</p> <ol><li>Définissez la propriété <a href="https://developers.google.com/web/fundamentals/app-install-banners/native#prefer_related_applications" target="_blank" rel="noopener noreferrer">prefer_related_applications<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> sur <code>false</code> dans le fichier manifeste.</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>Ajouter un bouton masqué par défaut et qui servira à afficher l'invite.</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>install_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hidden</span><span class="token punctuation">&gt;</span></span>Install<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="3"><li>Dans le JavaScript principal, intercepter l'évènement <code>beforeinstallprompt</code> qui est déclenché lorsque la PWA satisfait les critères d'installation. Dans le gestionnaire de l'évènement, on gardera une référence vers son paramètre et on affichera le bouton d'installation.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> deferredPrompt<span class="token punctuation">;</span> <span class="token comment">// Allows to show the install prompt</span>
<span class="token keyword">const</span> installButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;install_button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt fired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Prevent Chrome 76 and earlier from automatically showing a prompt</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Stash the event so it can be triggered later.</span>
  deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
  <span class="token comment">// Show the install button</span>
  installButton<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  installButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> installApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>Ajouter la fonction <code>installApp()</code> qui est lancée suite au clic sur le bouton, et qui affiche l'invite d'installation en utilisant la référence récupérée dans le <code>beforeinstallprompt</code>:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">installApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Show the prompt</span>
  deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  installButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token comment">// Wait for the user to respond to the prompt</span>
  deferredPrompt<span class="token punctuation">.</span>userChoice<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">&quot;accepted&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PWA setup accepted&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      installButton<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PWA setup rejected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    installButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Optionnellement, on peut être avertis de la fin de l'installation.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled&quot;</span><span class="token punctuation">,</span> <span class="token parameter">evt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled fired&quot;</span><span class="token punctuation">,</span> evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">Expérimental</p> <p>Les événements <code>beforeinstallprompt</code> et <code>appinstalled</code> sont encore au stade expérimental et ne sont pas encore standardisés. Au jour du 17 janvier 2020, ils n'étaient encore supportés que sur les navigateurs Chrome, Chrome for Android et Samsung Internet.</p></div> <p>Il est maintenant temps de tester ! N'hésitez pas à forcer un nettoyage du cache.</p> <p><img src="/assets/img/pwa_setup_button.1a13ee70.png" alt="PWA install button"> <img src="/assets/img/pwa_setup_prompt.4b3c7ae2.png" alt="PWA install prompt"></p> <p>La PWA lancée en mode standalone sur macOS ressemble à cela:</p> <p><img src="/assets/img/pwa_installed.7df4c154.png" alt="PWA installed"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fr/4-api-cache/" class="prev">4. Stratégie de Cache pour API REST</a></span> <span class="next"><a href="/fr/6-background-sync/">6. Background sync et notifications</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ef97a632.js" defer></script><script src="/assets/js/3.c69d9a44.js" defer></script><script src="/assets/js/6.4e5f5461.js" defer></script>
  </body>
</html>
